{% extends "../base.html" %}

{% block title %}MyTask{% end %}

{% block body%}
    <div class="container flat_container" >
        <div class="panel timeline " >
            <title>Daily Progress</title>
            <section class="global_activity">
                <h1>岁月匆匆，往事不随风</h1>
                <section class="stream" id="operations">
                </section>
            </section>
        </div>
    </div>
{% end %}

{% block script %}
$(function(){
function callback(responseData) {
    var $operations = $('#operations')
    var lastDay = ''
    var lastProjectId = 0
    var classArray = ["left", "right"]
    var lastIndex = 1
    var flag = false
    for(var i in responseData.content) {
        var operation = responseData.content[i]
        var actionStr = '<div class="event_container" style="">'
        var createTime = $.lily.format.parseDate(operation.createTime, "yyyy-mm-dd hh:mi:ss")
        if(!createTime.isSameDay(lastDay)) {
            actionStr += '<div class="day">'
                + '<a href="/2203367/summary/2013-05-07" class="decorated">'
                + '<span>'
                + '<span>May 7</span>'
                + '<time date-days-ago="" >Tuesday</time>'
                + '</span>'
                + '</a>'
                + '</div>'
            lastProjectId = 0
            lastIndex = (lastIndex + 1) % 2
            flag = true
        }
        lastDay = createTime
        if(lastProjectId != operation.project_id) {
            if(!flag)
                lastIndex = (lastIndex + 1) % 2
            actionStr += '<div class="project chiral ' + classArray[lastIndex] + '" style="">'
                + '<a data-default-stack="true" href="/2203367/projects/2742854-test11">test11</a>'
                + '</div>'
        }
        flag = false
        lastProjectId = operation.project_id
        actionStr += '<article class="event chiral ' + classArray[lastIndex] + '" data-side="left">'
            + '<div class="time">'
            + '<span class="time_only">'
            + '<time data-local-time="" datetime="2013-05-07T09:09:09Z" style="">5:09pm</time>'
            + '</span>'
            + '</div>'
            + '<div class="avatar">'
            + '<a data-stacker="false" href="/2203367/people/4061968-miaoqishen">'
            + '<img class="avatar" height="48" src="/avatar/' + operation.own.avatar + '" title="' + operation.own.name + '" width="48">'
            + '</a>'
            + '</div>'
            + '<div class="action">'
            + '<span class="creator" data-creator-id="4061968">'
            + operation.own.name
            + '</span>'
            + '<span class="in_timeline">'
            + $.lily.param.getDisplay("OPERATION_TYPE", operation.operation_type) 
            + $.lily.param.getDisplay("TARGET_TYPE", operation.target_type)
            + '<span class="suffix">:</span> '
            + '<a class="decorated" href="/project/2742854-test11">test11</a>'
            + '</span>'
            + '</div>'
            + '</article>'
            + '</div>'
        $operations.append(actionStr)
    }
}

function queryOperation(begin){
    $.lily.ajax({
        url : '/operation',
        data : {begin: begin, size: 30},
		type: 'post',
		processResponse : callback
	});
}
queryOperation(0)
})
{% end %}
